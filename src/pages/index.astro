---
import { getCollection } from "astro:content";
import Container from "@components/Container.astro";
import PageLayout from "@layouts/PageLayout.astro";
import ProjectCard from "@components/ProjectCard.astro";
import Link from "@components/Link.astro";
import { SITE } from "@consts";
import { t } from "@lib/i18n";

// Detect current language from URL
const currentPath = Astro.url.pathname;
const currentLang = currentPath.startsWith('/fr') ? 'fr' : 'en';
const langPrefix = currentLang === 'fr' ? '/fr' : '';
const projectsHref = `${langPrefix}/projects`;
const contactHref = `${langPrefix}/contact`;

// Get English projects
const projects = (await getCollection("projects", ({ id }) => {
  return id.startsWith('en/');
}))
  .filter(project => !project.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 3);



---

<PageLayout title={t("hero.title", currentLang)} description={t("hero.subtitle", currentLang)}>
  <Container>
    <div class="space-y-16">
      <!-- Hero Section with Image -->
      <section class="animate">
        <div class="flex flex-col md:flex-row gap-8 items-center">
          <div class="flex-1 space-y-4">
            <h1 class="text-3xl font-bold text-black dark:text-white">
              {t("hero.title", currentLang)}
            </h1>
            <p class="text-lg opacity-90">
              {t("hero.subtitle", currentLang)}
            </p>
          </div>
          <div class="flex-shrink-0 w-full md:w-auto">
            <img 
              src="/images/hero-tangent.png" 
              alt="Tangent visualization" 
              class="w-full md:w-80 h-auto rounded-lg border-2 border-green-500/20"
            />
          </div>
        </div>
      </section>

      <!-- Services Section -->
      <section class="animate space-y-8">
        <h2 class="text-2xl font-semibold text-black dark:text-white">
          {t("services.title", currentLang)}
        </h2>
        
        <div class="grid gap-6 md:grid-cols-1 lg:grid-cols-3">
          <!-- Service 1 -->
          <div class="space-y-3 p-6 border border-black/10 dark:border-white/10 rounded-lg">
            <h3 class="text-xl font-semibold text-black dark:text-white">
              {t("services.service1.title", currentLang)}
            </h3>
            <p class="text-sm opacity-75">
              {t("services.service1.description", currentLang)}
            </p>
            <p class="text-xs opacity-50 italic">
              {t("services.service1.keywords", currentLang)}
            </p>
          </div>

          <!-- Service 2 -->
          <div class="space-y-3 p-6 border border-black/10 dark:border-white/10 rounded-lg">
            <h3 class="text-xl font-semibold text-black dark:text-white">
              {t("services.service2.title", currentLang)}
            </h3>
            <p class="text-sm opacity-75">
              {t("services.service2.description", currentLang)}
            </p>
            <p class="text-xs opacity-50 italic">
              {t("services.service2.keywords", currentLang)}
            </p>
          </div>

          <!-- Service 3 -->
          <div class="space-y-3 p-6 border border-black/10 dark:border-white/10 rounded-lg">
            <h3 class="text-xl font-semibold text-black dark:text-white">
              {t("services.service3.title", currentLang)}
            </h3>
            <p class="text-sm opacity-75">
              {t("services.service3.description", currentLang)}
            </p>
            <p class="text-xs opacity-50 italic">
              {t("services.service3.keywords", currentLang)}
            </p>
          </div>
        </div>
      </section>

      <!-- Recent Projects Section -->
      <section class="animate space-y-6">
        <div class="flex flex-wrap gap-y-2 items-center justify-between">
          <h2 class="text-2xl font-semibold text-black dark:text-white">
            {t("home.recentProjects", currentLang)}
          </h2>
          <Link href={projectsHref}>
            {t("home.seeAllProjects", currentLang)}
          </Link>
        </div>
        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
          {projects.map(project => (
            <ProjectCard project={project} />
          ))}
        </div>
      </section>

      <!-- Contact Section -->
      <section class="animate space-y-4">
        <h2 class="text-2xl font-semibold text-black dark:text-white">
          {t("home.letsConnect", currentLang)}
        </h2>
        <article>
          <p>
            {t("home.reachOut", currentLang)}
          </p>
        </article>
        <div class="flex gap-4">
          <Link href={contactHref}>
            {t("nav.contact", currentLang)}
          </Link>
          <span>/</span>
          <Link href={`mailto:${SITE.EMAIL}`} aria-label={`Email ${SITE.NAME}`}>
            {SITE.EMAIL}
          </Link>
        </div>
      </section>
    </div>
  </Container>
</PageLayout>
